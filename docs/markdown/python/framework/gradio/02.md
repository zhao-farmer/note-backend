# 二、 构建页面-输入输出

## 2.1 核心组件

- 界面（Interface）：Gradio的核心是Interface类，它允许用户定义输入和输出类型，创建交互式的Web界面。
- 输入类型：Gradio支持多种输入类型，如gr.Text用于文本输入，gr.Image用于图像上传，gr.Audio用于音频输入等。
- 输出类型：输出类型与输入类型相对应，包括gr.Text、gr.Image和gr.Audio等，用于展示模型的输出结果。


## 2.2 创建Gradio应用

创建一个简单的“Hello World”示例,在这个例子中，我们将创建一个简单的Gradio应用，它接受用户的名字作为输入，并返回一个问候语。

1. 设置开发环境： 首先，确保你的Python环境中已经安装了Gradio。如果尚未安装，可以通过以下命令安装：

    ```sh
    pip install gradio
    ```
2. 编写Python脚本： 打开一个新的Python脚本文件，比如命名为gradio_hello_world.py。
3. 导入Gradio库： 在脚本的开始处导入Gradio库：

    ```sh
    import gradio as gr
    ```
4. 定义处理函数： 接下来，定义一个处理用户输入的函数。这个函数将接收一个字符串参数（用户的名字），并返回一个问候语。

    ```python
    defgreet(name): returnf"Hello {name}!"
    ```
5. 创建Gradio界面： 使用Gradio的Interface类来创建一个交互式界面。这个界面将有一个文本输入框和一个文本输出框。

    ```python
    iface = gr.Interface(fn=greet, inputs="text", outputs="text")
    ```
6. 运行应用： 最后，使用launch()方法启动你的应用。

    ```python
    iface.launch()
    ```
7. 尝试你的应用： 运行脚本后，你的默认Web浏览器会打开一个新的页面，显示你的Gradio应用。在文本框中输入你的名字，点击提交，你会看到问候语出现在下方。

## 2.3 界面元素介绍
    
    详解不同的输入输出组件,Gradio提供了多种输入和输出组件，适应不同的数据类型和展示需求。了解这些组件对于设计有效的Gradio界面至关重要。

1. 输入组件 (Inputs)

    1. Audio：允许用户上传音频文件或直接录音。参数：source: 指定音频来源（如麦克风）、type: 指定返回类型。 
        
        示例：`gr.Audio(source="microphone", type="filepath")`
    2. Checkbox：提供复选框，用于布尔值输入。参数：label: 显示在复选框旁边的文本标签。 
        
        示例：`gr.Checkbox(label="同意条款")`
    3. CheckboxGroup：允许用户从一组选项中选择多个。参数：choices: 字符串数组，表示复选框的选项、label: 标签文本。

        示例：`gr.CheckboxGroup(["选项1", "选项2", "选项3"], label="选择你的兴趣")`

    4. ColorPicker：用于选择颜色，通常返回十六进制颜色代码。参数：default: 默认颜色值。     

        示例：`gr.ColorPicker(default="#ff0000")`
    5. Dataframe：允许用户上传CSV文件或输入DataFrame。参数：headers: 列标题数组、row_count: 初始显示的行数。

        示例：`gr.Dataframe(headers=["列1", "列2"], row_count=5)`

    6. Dropdown：下拉菜单，用户可以从中选择一个选项。参数：choices: 字符串数组，表示下拉菜单的选项、label: 标签文本。

        示例：`gr.Dropdown(["选项1", "选项2", "选项3"], label="选择一个选项")`

    7. File：用于上传任意文件，支持多种文件格式。参数：file_count: 允许上传的文件数量，如"single"或"multiple"、type: 返回的数据类型，如"file"或"auto"。

        示例：`gr.File(file_count="single", type="file")`
    8. Image：用于上传图片，支持多种图像格式。参数：type图像类型，如pil。

        示例：`gr.Image(type='pil')`
    9. Number：数字输入框，适用于整数和浮点数。参数：default: 默认数字、label: 标签文本。

        示例：`gr.Number(default=0, label="输入一个数字")`
    10. Radio：单选按钮组，用户从中选择一个选项。参数：choices: 字符串数组，表示单选按钮的选项、label: 标签文本。

        示例：`gr.Radio(["选项1", "选项2", "选项3"], label="选择一个选项")`
    11. Slider：滑动条，用于选择一定范围内的数值。参数：minimum: 最小值、maximum: 最大值、step: 步长、label: 标签文本。

        示例：`gr.Slider(minimum=0, maximum=10, step=1, label="调整数值")`
    12. Textbox：单行文本输入框，适用于简短文本。参数：default: 默认文本、placeholder: 占位符文本。

        示例：`gr.Textbox(default="默认文本", placeholder="输入文本")`
    13. Textarea：多行文本输入区域，适合较长的文本输入。参数：lines: 显示行数、placeholder: 占位符文本。

        示例：`gr.Textarea(lines=4, placeholder="输入长文本")`
    14. Time：用于输入时间。参数：label: 标签文本。

        示例：`gr.Time(label="选择时间")`
    15. Video：视频上传组件，支持多种视频格式。参数：label: 标签文本。

        示例：`gr.Video(label="上传视频")`
    16. Data：用于上传二进制数据，例如图像或音频的原始字节。参数：type: 数据类型，如"auto"自动推断。
        
        示例：`gr.Data(type="auto", label="上传数据")`

2. 输出组件 (Outputs)

    1. Audio：播放音频文件。参数：type 指定输出格式。

        示例：`gr.Audio(type="auto")`
    2. Carousel：以轮播方式展示多个输出，适用于图像集或多个数据点。参数：item_type 设置轮播项目类型。
        
        示例：`gr.Carousel(item_type="image")`
    3. Dataframe：展示Pandas DataFrame，适用于表格数据。参数：type 指定返回的DataFrame类型。

        示例：`gr.Dataframe(type="pandas")`
    4. Gallery：以画廊形式展示一系列图像。
    5. HTML：展示HTML内容，适用于富文本或网页布局。
    6. Image：展示图像。参数：type 指定图像格式。 

        示例：`gr.Image(type="pil")`
    7. JSON：以JSON格式展示数据，便于查看结构化数据。
    8. KeyValues：以键值对形式展示数据。
    9. Label：展示文本标签，适用于简单的文本输出。
    10. Markdown：支持Markdown格式的文本展示。
    11. Plot：展示图表，如matplotlib生成的图表。
    12. Text：用于显示文本，适合较长的输出。
    13. Video：播放视频文件。


## 2.4 示例图 - 输入组件：
    
- 代码
    ```python
    import gradio as gr
    input_list = [
        # 上传文件或录音 microphone-麦克风 upload-上传 数据类型numpy label
        gr.Audio(sources=["microphone","upload"],type="numpy",label="Audio File"),
        # 多选框
        gr.Checkbox(label="Checkbox"),
        # 选择颜色
        gr.ColorPicker(label="Color Picker"),
        # 表格格式，可以上传csv
        gr.DataFrame(label="DataFrame"),
        # 下拉菜单 前端一般是select
        gr.Dropdown(["option 1","option 2","option 3"],label="Dropdown"),
        # 文件获取 binary二进制类型
        gr.File(label="File",type="binary"),
        # 图片 webcam-web照相机 upload-上传
        gr.Image(sources=["webcam","upload"],label="Image"),
        # 数字选择框
        gr.Number(label="Number"),
        # 单选框
        gr.Radio(["option 1","option 2","option 3"],label="Radio"),
        # 滑动条
        gr.Slider(minimum=0,maximum=10,label="Slider",step=5),
        # 文字输入框 默认lines= 1
        gr.Textbox(label="Textbox",lines=3,max_lines=7,placeholder="Placeholder"),
        # 文本输入框 默认lines = 5
        gr.TextArea(label="Textbox",lines=3,max_lines=7,placeholder="Placeholder"),
        # 视频 webcam-web照相机 upload-上传
        gr.Video(sources=["webcam","upload"],label="Video"),
    ]
    
    output_list = [
        gr.Textbox(label="Audio outputs",lines=7),
        gr.Textbox(label="Check outputs"),
        gr.Textbox(label="Color Picker outputs"),
        gr.Textbox(label="DataFrame outputs"),
        gr.Textbox(label="Dropdown outputs"),
        gr.Textbox(label="File outputs"),
        gr.Textbox(label="Image outputs"),
        gr.Textbox(label="Number outputs"),
        gr.Textbox(label="Radio outputs"),
        gr.Textbox(label="Slider outputs"),
        gr.Textbox(label="Textbox outputs"),
        gr.Textbox(label="Text Area outputs"),
        gr.Textbox(label="Video outputs"),
    ]
    
    def input_and_output(*input_data):
        return input_data
    
    iface = gr.Interface(fn=input_and_output, #由input向output传递的参数
                         inputs=input_list,    #input_list输入框列表
                         outputs=output_list,   #output_list输出框列表
                         title="Input and Output",  #标题
                         description="This is a test of all the input types.",  #具体的解释
                         live=True,  #live = True 时不使用submit input数据也传输到output
                         )
    iface.launch()
    ```

- 页面展示
    
    ![](/python/framework/gradio/004.png)
    
    
## 2.5 示例图 - 输出组件：

1. 声音

    ```python
    import gradio as gr
    def audio_fn(audio):
        # 音频采样率
        hz = audio[0]
        # 音频本身
        data = audio[1]
        return  hz,data
    demo = gr.Interface(fn=audio_fn,inputs=gr.Audio(type="numpy"),outputs="audio")
    # filepath
    # def audio_fn(audio):
    #     return  audio
    #
    # demo = gr.Interface(fn=audio_fn,inputs=gr.Audio(type="filepath"),outputs="audio")
    demo.launch()
    ```

2. 柱状图

    ```python
    import gradio as gr
    import pandas as pd
    simple = pd.DataFrame({
        "a": [1,2,3],
        "b": [4,5,6]
    })
    demo = gr.Interface(fn=None,inputs=None,outputs=gr.BarPlot(simple,x="a",y="b"))
    demo.launch()
    ```
    
3. Gallery图片列表

    ```python
    import gradio as gr
    def process():
        # 图像
        cheetahs = [
            "https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2023%2F0103%2Fb746eb5cj00rnwgou003wd000vk01k4m.jpg&thumbnail=660x2147483647&quality=80&type=jpg",
            "https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2023%2F0103%2Fd21c881aj00rnwgos004jd000vk01k4m.jpg&thumbnail=660x2147483647&quality=80&type=jpg",
            "https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2023%2F0103%2Fc894297cj00rnwgot003nd000vk01k4m.jpg&thumbnail=660x2147483647&quality=80&type=jpg",
            "https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2023%2F0103%2F1053f980j00rnwgos003kd000vk01k4m.jpg&thumbnail=660x2147483647&quality=80&type=jpg",
            "https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2023%2F0103%2F1677746bj00rnwgo60047d000vl01k5m.jpg&thumbnail=660x2147483647&quality=80&type=jpg",
            "https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2023%2F0103%2F86148a4bj00rnwgo7003pd000vl01k5m.jpg&thumbnail=660x2147483647&quality=80&type=jpg",
            "https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2023%2F0103%2Fbe46ab41j00rnwgoc003xd000vl01k5m.jpg&thumbnail=660x2147483647&quality=80&type=jpg",
        ]
        # 图像加文字
        cheetahs = [(cheetah,f"Cheetah {i + 1}") for i,cheetah in enumerate(cheetahs)]
        return cheetahs
    demo = gr.Interface(fn=process,inputs=None,outputs=gr.Gallery(columns=5))
    demo.launch()
    ```

4. 折线图 柱状图
    
    ```python
    import gradio as gr
    import numpy as np
    import matplotlib.pyplot as plt
    def fig_ouput():
        Fs = 8000
        f = 5
        sample = 10
        x = np.arange(sample)
        y = np.sin(2 * np.pi * f * x /Fs)
        # 折线图
        # plt.plot(x,y)
        # 柱状图
        plt.bar(x, y)
        return plt
    demo = gr.Interface(fn=fig_ouput,inputs=None,outputs=gr.Plot())
    demo.launch()
    
    TextBox
    import gradio as gr
    def fig_ouput():
        return "Hello World"
    demo = gr.Interface(fn=fig_ouput,inputs=None,outputs=gr.Textbox())
    demo.launch()
    ```

5. Json

    ```python    
    import gradio as gr
    
    json_sample = {"name":"john","age":30,"city":"New York"}
    demo = gr.Interface(fn=None,inputs=None,outputs=gr.Json(json_sample))
    demo.launch()
    ```
6. Html

    ```python 
    import gradio as gr
    
    demo = gr.Interface(fn=None,inputs=None,outputs=gr.HTML(value="<h1>hello</h1>"))
    demo.launch()
    ```
